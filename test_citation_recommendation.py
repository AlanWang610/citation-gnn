#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
Test script for citation recommendation using evaluate_gnn.py.

This script demonstrates how to use the citation recommendation system
with the example paper from the original task.

The script supports both transductive and inductive settings:
- Transductive: The paper is already in the graph
- Inductive: The paper is new and not part of the training data
"""

import json
import os
import argparse
import random

def format_feature_importance(importance_data):
    """Format feature importance data for display."""
    if not importance_data:
        return ""
    
    lines = []
    lines.append(f"    ðŸ“Š FEATURE IMPORTANCE ANALYSIS:")
    lines.append(f"    â”œâ”€ Prediction Score: {importance_data['baseline_score']:.4f}")
    
    # Node embedding analysis
    node_metrics = importance_data['node_embedding_metrics']
    lines.append(f"    â”œâ”€ Node Embedding Analysis:")
    lines.append(f"    â”‚  â”œâ”€ Cosine Similarity: {node_metrics['cosine_similarity']:.4f}")
    lines.append(f"    â”‚  â”œâ”€ Euclidean Distance: {node_metrics['euclidean_distance']:.4f}")
    lines.append(f"    â”‚  â””â”€ Contribution: {node_metrics['contribution']:.4f}")
    
    # Contribution breakdown
    breakdown = importance_data['contribution_breakdown']
    lines.append(f"    â”œâ”€ Overall Contribution:")
    lines.append(f"    â”‚  â”œâ”€ Node Embeddings: {breakdown['node_embedding_percentage']:.1f}%")
    lines.append(f"    â”‚  â””â”€ Edge Features: {breakdown['edge_feature_percentage']:.1f}%")
    
    # Top edge features
    edge_importance = importance_data['edge_feature_metrics']['individual_importance']
    lines.append(f"    â””â”€ Top Edge Features:")
    for i, (feature_name, feature_data) in enumerate(list(edge_importance.items())[:3]):
        symbol = "â”œâ”€" if i < 2 else "â””â”€"
        lines.append(f"       {symbol} {feature_name}: {feature_data['importance']:.4f} (value: {feature_data['feature_value']:.2f})")
    
    return "\n".join(lines)

def main():
    """Main function to run the test."""
    parser = argparse.ArgumentParser(description='Test citation recommendation system')
    parser.add_argument('--output-dir', type=str, default='results', help='Directory to save results')
    parser.add_argument('--observed-ratio', type=float, default=0.75, 
                        help='Ratio of citations to observe (default: 0.75)')
    parser.add_argument('--top-k', type=int, default=50, help='Number of top recommendations to return (default: 50)')
    parser.add_argument('--device', type=str, default='cpu', choices=['cpu', 'cuda'], 
                        help='Device to run the model on')
    parser.add_argument('--inductive', action='store_false',
                        help='Use transductive mode (default is inductive)')
    parser.add_argument('--test-paper', type=str, default=None,
                        help='Path to a JSON file containing a test paper (optional)')
    parser.add_argument('--feature-importance', action='store_true', default=True,
                        help='Include detailed feature importance analysis for each recommendation (enabled by default)')
    args = parser.parse_args()
    
    # Force feature importance to always be True
    args.feature_importance = True
    
    # Create output directory if it doesn't exist
    os.makedirs(args.output_dir, exist_ok=True)
    
    # Load test paper
    example_paper = {"doi": "10.1111/jofi.13455", "type": "journal-article", "published_date": "2025-04-01", "title": "Women in Charge: Evidence from Hospitals", "journal": "The Journal of Finance", "abstract": "<jats:title>ABSTRACT</jats:title><jats:p>The paper examines the decision\u2010making, compensation, and turnover of female CEOs in U.S. hospitals. Contrary to the literature on lower\u2010ranked executives and directors in public firms, there is no evidence that gender differences in preferences for risk or altruism affect decision\u2010making of hospital CEOs: corporate policies do not shift when women take (or leave) office, and male and female CEOs respond similarly to a major financial shock. However, female CEOs earn lower salaries, face flatter pay\u2010for\u2010performance incentives, and exhibit greater turnover after poor performance. Hospital boards behave as though they perceive female CEOs as less productive.</jats:p>", "volume": None, "issue": None, "authors": [["KATHARINA", "LEWELLEN", None]], "references": [{"reference_type": "article", "doi": "10.1016/j.jfineco.2008.10.007", "year": 2009, "title": "Women in the boardroom and their impact on governance and performance\u2606", "journal": "Journal of Financial Economics", "volume": "94", "issue": "2", "authors": [["Ren\u00e9e B.", "Adams", None], ["Daniel", "Ferreira", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1287/mnsc.1110.1452", "year": 2012, "title": "Beyond the Glass Ceiling: Does Gender Matter?", "journal": "Management Science", "volume": "58", "issue": "2", "authors": [["Ren\u00e9e B.", "Adams", "Australian School of Business, University of New South Wales, Sydney, NSW 2052, Australia"], ["Patricia", "Funk", "Universitat Pompeu Fabra and Barcelona Graduate School of Economics, 08005 Barcelona, Spain"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1002/smj.940", "year": 2011, "title": "Shareholders and stakeholders: How do directors decide?", "journal": "Strategic Management Journal", "volume": "32", "issue": "12", "authors": [["Ren\u00e9e B.", "Adams", None], ["Amir N.", "Licht", None], ["Lilach", "Sagiv", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.2139/ssrn.3224667", "year": 2018, "title": "Hospital Financial Health and Clinical Choices: Evidence From the Financial Crisis", "journal": "SSRN Electronic Journal", "volume": None, "issue": None, "authors": [["Manuel", "Adelino", None], ["Katharina", "Lewellen", None], ["W. Ben", "McCartney", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1111/jofi.12234", "year": 2015, "title": "Investment Decisions of Nonprofit Firms: Evidence from Hospitals", "journal": "The Journal of Finance", "volume": "70", "issue": "4", "authors": [["MANUEL", "ADELINO", None], ["KATHARINA", "LEWELLEN", None], ["ANANT", "SUNDARAM", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1257/aer.20221705", "year": 2024, "title": "Merchants of Death: The Effect of Credit Supply Shocks on Hospital Outcomes", "journal": "American Economic Review", "volume": "114", "issue": "11", "authors": [["Cyrus", "Aghamolla", "Rice University (email: )"], ["Pinar", "Karaca-Mandic", "University of Minnesota and NBER (email: )"], ["Xuelin", "Li", "Columbia University (email: )"], ["Richard T.", "Thakor", "University of Minnesota and MIT LFE (email: )"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1111/j.1540-6261.1994.tb00085.x", "year": 1994, "title": "Executive Careers and Compensation Surrounding Takeover Bids", "journal": "The Journal of Finance", "volume": "49", "issue": "3", "authors": [["ANUP", "AGRAWAL", None], ["RALPH A.", "WALKLING", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1093/qje/qjr049", "year": 2012, "title": "The Changing of the Boards: The Impact on Firm Valuation of Mandated Female Board Representation *", "journal": "The Quarterly Journal of Economics", "volume": "127", "issue": "1", "authors": [["Kenneth R.", "Ahern", None], ["Amy K.", "Dittmar", None]], "working_paper_institution": None}, {"reference_type": "book", "doi": "10.1108/s0147-912120150000042001", "year": 2015, "title": "Gender and Dynamic Agency: Theory and Evidence on the Compensation of Top Executives", "journal": "Research in Labor Economics", "volume": None, "issue": None, "authors": [["Stefania", "Albanesi", None], ["Claudia", "Olivetti", None], ["Mar\u00eda Jos\u00e9", "Prados", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1162/003355301556419", "year": 2001, "title": "Which is the Fair Sex? Gender Differences in Altruism", "journal": "The Quarterly Journal of Economics", "volume": "116", "issue": "1", "authors": [["J.", "Andreoni", None], ["L.", "Vesterlund", None]], "working_paper_institution": None}, {"reference_type": "book", "doi": "10.7312/fink16380-007", "year": 2014, "title": "Arrow (1963): Uncertainty and the Welfare Economics of Medical Care Notes On Contributors", "journal": "Moral Hazard in Health Insurance", "volume": None, "issue": None, "authors": [["Kenneth J.", "Arrow", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1257/aer.90.4.765", "year": 2000, "title": "Mentoring and Diversity", "journal": "American Economic Review", "volume": "90", "issue": "4", "authors": [["Susan", "Athey", "Department of Economics, Massachusetts Institute of Technology, 50 Memorial Drive, Cambridge, MA 02142."], ["Christopher", "Avery", "Kennedy School of Government, Harvard University, Cambridge, MA 02138."], ["Peter", "Zemsky", "INSEAD, Boulevard de Constance, Fountainbleau Cedex 77305, France."]], "working_paper_institution": None}, {"reference_type": "book", "doi": "10.1515/9781400825691", "year": 2004, "title": "Women Don't Ask", "journal": None, "volume": None, "issue": None, "authors": [["Linda", "Babcock", None], ["Sara", "Laschever", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.2139/ssrn.3777576", "year": 2021, "title": "Regulating CEO Pay: Evidence from the Nonprofit Revitalization Act", "journal": "SSRN Electronic Journal", "volume": None, "issue": None, "authors": [["Ilona", "Babenko", None], ["Benjamin", "Bennett", None], ["Rik", "Sen", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1111/j.1467-937x.2009.00601.x", "year": 2010, "title": "Can Gender Parity Break the Glass Ceiling? Evidence from a Repeated Randomized Experiment", "journal": "Review of Economic Studies", "volume": "77", "issue": "4", "authors": [["MANUEL F.", "BAGUES", None], ["BERTA", "ESTEVE-VOLART", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1111/j.1540-6261.1988.tb04593.x", "year": 1988, "title": "Compensation and Incentives: Practice vs. Theory", "journal": "The Journal of Finance", "volume": "43", "issue": "3", "authors": [["GEORGE P.", "BAKER", None], ["MICHAEL C.", "JENSEN", None], ["KEVIN J.", "MURPHY", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1056/nejmsa1901383", "year": 2020, "title": "Changes in Quality of Care after Hospital Mergers and Acquisitions", "journal": "New England Journal of Medicine", "volume": "382", "issue": "1", "authors": [["Nancy D.", "Beaulieu", "From the Department of Health Care Policy, Harvard Medical School (N.D.B., B.E.L., J.B.D., J.M.M.), Harvard Business School and the National Bureau of Economic Research (L.S.D.), the Division of General Internal Medicine and Primary Care, Department of Medicine, Beth Israel Deaconess Medical Center (B.E.L.), and the Division of General Internal Medicine, Department of Medicine, Brigham and Women\u2019s Hospital (I.K., J.M.M.) \u2014 all in Boston."], ["Leemore S.", "Dafny", "From the Department of Health Care Policy, Harvard Medical School (N.D.B., B.E.L., J.B.D., J.M.M.), Harvard Business School and the National Bureau of Economic Research (L.S.D.), the Division of General Internal Medicine and Primary Care, Department of Medicine, Beth Israel Deaconess Medical Center (B.E.L.), and the Division of General Internal Medicine, Department of Medicine, Brigham and Women\u2019s Hospital (I.K., J.M.M.) \u2014 all in Boston."], ["Bruce E.", "Landon", "From the Department of Health Care Policy, Harvard Medical School (N.D.B., B.E.L., J.B.D., J.M.M.), Harvard Business School and the National Bureau of Economic Research (L.S.D.), the Division of General Internal Medicine and Primary Care, Department of Medicine, Beth Israel Deaconess Medical Center (B.E.L.), and the Division of General Internal Medicine, Department of Medicine, Brigham and Women\u2019s Hospital (I.K., J.M.M.) \u2014 all in Boston."], ["Jesse B.", "Dalton", "From the Department of Health Care Policy, Harvard Medical School (N.D.B., B.E.L., J.B.D., J.M.M.), Harvard Business School and the National Bureau of Economic Research (L.S.D.), the Division of General Internal Medicine and Primary Care, Department of Medicine, Beth Israel Deaconess Medical Center (B.E.L.), and the Division of General Internal Medicine, Department of Medicine, Brigham and Women\u2019s Hospital (I.K., J.M.M.) \u2014 all in Boston."], ["Ifedayo", "Kuye", "From the Department of Health Care Policy, Harvard Medical School (N.D.B., B.E.L., J.B.D., J.M.M.), Harvard Business School and the National Bureau of Economic Research (L.S.D.), the Division of General Internal Medicine and Primary Care, Department of Medicine, Beth Israel Deaconess Medical Center (B.E.L.), and the Division of General Internal Medicine, Department of Medicine, Brigham and Women\u2019s Hospital (I.K., J.M.M.) \u2014 all in Boston."], ["J. Michael", "McWilliams", "From the Department of Health Care Policy, Harvard Medical School (N.D.B., B.E.L., J.B.D., J.M.M.), Harvard Business School and the National Bureau of Economic Research (L.S.D.), the Division of General Internal Medicine and Primary Care, Department of Medicine, Beth Israel Deaconess Medical Center (B.E.L.), and the Division of General Internal Medicine, Department of Medicine, Brigham and Women\u2019s Hospital (I.K., J.M.M.) \u2014 all in Boston."]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1257/089533003769204362", "year": 2003, "title": "Executive Compensation as an Agency Problem", "journal": "Journal of Economic Perspectives", "volume": "17", "issue": "3", "authors": [["Lucian Arye", "Bebchuk", "William J. Friedman Professor of Law, Economics and Finance, Harvard Law School, and Research Associate, National Bureau of Economic Research, both in Cambridge, Massachusetts."], ["Jesse M", "Fried", "Boalt Hall School of Law, University of California at Berkeley, Berkeley, California."]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.2307/1600632", "year": 2002, "title": "Managerial Power and Rent Extraction in the Design of Executive Compensation", "journal": "The University of Chicago Law Review", "volume": "69", "issue": "3", "authors": [["Lucian Arye", "Bebchuk", None], ["Jesse M.", "Fried", None], ["David I.", "Walker", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.5465/amproc.2023.19580abstract", "year": 2023, "title": "Potential and the Gender Promotion Gap", "journal": "Academy of Management Proceedings", "volume": "2023", "issue": "1", "authors": [["Alan M.", "Benson", "U. of Minnesota"], ["Danielle", "Li", "MIT"], ["Kelly", "Shue", "Yale Business School"]], "working_paper_institution": None}, {"reference_type": "working_paper", "doi": "10.3386/w20256", "year": 2014, "title": "Breaking the Glass Ceiling? The Effect of Board Quotas on Female Labor Market Outcomes in Norway", "journal": None, "volume": None, "issue": None, "authors": [["Marianne", "Bertrand", None], ["Sandra", "Black", None], ["Sissel", "Jensen", None], ["Adriana", "Lleras-Muney", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1177/001979390105500101", "year": 2001, "title": "The Gender Gap in Top Corporate Jobs", "journal": "ILR Review", "volume": "55", "issue": "1", "authors": [["Marianne", "Bertrand", None], ["Kevin F.", "Hallock", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1162/003355303322552775", "year": 2003, "title": "Managing with Style: The Effect of Managers on Firm Policies", "journal": "The Quarterly Journal of Economics", "volume": "118", "issue": "4", "authors": [["M.", "Bertrand", None], ["A.", "Schoar", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1093/qje/qjab026", "year": 2021, "title": "Flexible Wages, Bargaining, and the Gender Gap", "journal": "The Quarterly Journal of Economics", "volume": "137", "issue": "1", "authors": [["Barbara", "Biasi", "Yale University and National Bureau of Economic Research, United States, and Einaudi Institute for Economics and Finance, Italy"], ["Heather", "Sarsons", "University of Chicago and National Bureau of Economic Research, United States"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1257/jel.20160995", "year": 2017, "title": "The Gender Wage Gap: Extent, Trends, and Explanations", "journal": "Journal of Economic Literature", "volume": "55", "issue": "3", "authors": [["Francine D.", "Blau", "Cornell University, NBER, IZA, DIW, and CESifo"], ["Lawrence M.", "Kahn", "Cornell University, IZA, CESifo, and NCER (Australia)"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1257/aer.20170007", "year": 2019, "title": "Beliefs about Gender", "journal": "American Economic Review", "volume": "109", "issue": "3", "authors": [["Pedro", "Bordalo", "Sa\u00efd Business School, University of Oxford, Park End Street OX1 1HP, UK (email: )"], ["Katherine", "Coffman", "Harvard Business School, Soldiers Field, Boston, MA 02163 (email: )"], ["Nicola", "Gennaioli", "Department of Finance, Universit\u00e0 Bocconi, and IGIER, Via Roentgen 1, 20136 Milan, Italy (email: )"], ["Andrei", "Shleifer", "Department of Economics, Harvard University, 1805 Cambridge Street, Cambridge MA 02138 (email: )"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/j.obhdp.2006.09.001", "year": 2007, "title": "Social incentives for gender differences in the propensity to initiate negotiations: Sometimes it does hurt to ask", "journal": "Organizational Behavior and Human Decision Processes", "volume": "103", "issue": "1", "authors": [["Hannah Riley", "Bowles", None], ["Linda", "Babcock", None], ["Lei", "Lai", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1086/339493", "year": 2002, "title": "Managerial Incentives in Nonprofit Organizations: Evidence from Hospitals", "journal": "The Journal of Law and Economics", "volume": "45", "issue": "1", "authors": [["James A.", "Brickley", None], ["R. Lawrence", "Van Horn", None]], "working_paper_institution": None}, {"first-page": "964", "title": "Review of NSF economics proposals: Gender and institutional patterns", "volume": "83", "author": "Broder Ivy E.", "year": "1993", "journal": "American Economic Review", "reference_type": "article"}, {"reference_type": "article", "doi": "10.1016/j.jcorpfin.2012.06.008", "year": 2012, "title": "Is there a gender gap in CEO compensation?", "journal": "Journal of Corporate Finance", "volume": "18", "issue": "4", "authors": [["Martin", "Bugeja", None], ["Zoltan P.", "Matolcsy", None], ["Helen", "Spiropoulos", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1037/0033-2909.125.3.367", "year": 1999, "title": "Gender differences in risk taking: A meta-analysis.", "journal": "Psychological Bulletin", "volume": "125", "issue": "3", "authors": [["James P.", "Byrnes", None], ["David C.", "Miller", None], ["William D.", "Schafer", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/j.jpubeco.2012.12.006", "year": 2013, "title": "Gender differences in bargaining outcomes: A field experiment on discrimination", "journal": "Journal of Public Economics", "volume": "99", "issue": None, "authors": [["Marco", "Castillo", None], ["Ragan", "Petrie", None], ["Maximo", "Torero", None], ["Lise", "Vesterlund", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1111/j.1468-0262.2004.00539.x", "year": 2004, "title": "Women as Policy Makers: Evidence from a Randomized Policy Experiment in India", "journal": "Econometrica", "volume": "72", "issue": "5", "authors": [["Raghabendra", "Chattopadhyay", None], ["Esther", "Duflo", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/j.jfineco.2006.08.008", "year": 2008, "title": "Boards: Does one size fit all\u009d\u2606", "journal": "Journal of Financial Economics", "volume": "87", "issue": "2", "authors": [["J", "COLES", None], ["N", "DANIEL", None], ["L", "NAVEEN", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1093/qje/qjy020", "year": 2019, "title": "The Price Ain\u2019t Right? Hospital Prices and Health Spending on the Privately Insured*", "journal": "The Quarterly Journal of Economics", "volume": "134", "issue": "1", "authors": [["Zack", "Cooper", "Yale University"], ["Stuart V", "Craig", "University of Pennsylvania"], ["Martin", "Gaynor", "Carnegie Mellon University and National Bureau of Economic Research"], ["John", "Van Reenen", "Massachusetts Institute of Technology, Centre for Economic Performance, and National Bureau of Economic Research"]], "working_paper_institution": None}, {"reference_type": "working_paper", "doi": "10.3386/w29809", "year": 2022, "title": "Do Higher-Priced Hospitals Deliver Higher-Quality Care?", "journal": None, "volume": None, "issue": None, "authors": [["Zack", "Cooper", None], ["Joseph", "Doyle", None], ["John", "Graves", None], ["Jonathan", "Gruber", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1093/rfs/hhae024", "year": 2024, "title": "Financial Effects of Remote Product Delivery: Evidence from Hospitals", "journal": "The Review of Financial Studies", "volume": "37", "issue": "9", "authors": [["Kimberly", "Cornaggia", "Pennsylvania State University , USA"], ["Xuelin", "Li", "Columbia Business School , USA"], ["Zihan", "Ye", "University of Tennessee , USA"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1257/jel.47.2.448", "year": 2009, "title": "Gender Differences in Preferences", "journal": "Journal of Economic Literature", "volume": "47", "issue": "2", "authors": [["Rachel", "Croson", "University of Texas, Dallas."], ["Uri", "Gneezy", "University of California, San Diego."]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1257/aer.20210863", "year": 2023, "title": "The Old Boys\u2019 Club: Schmoozing and the Gender Gap", "journal": "American Economic Review", "volume": "113", "issue": "7", "authors": [["Zo\u00eb", "Cullen", "Harvard University and NBER (email: )"], ["Ricardo", "Perez-Truglia", "University of California, Berkeley and NBER (email: )"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1257/aer.20210863", "year": 2023, "title": "The Old Boys\u2019 Club: Schmoozing and the Gender Gap", "journal": "American Economic Review", "volume": "113", "issue": "7", "authors": [["Zo\u00eb", "Cullen", "Harvard University and NBER (email: )"], ["Ricardo", "Perez-Truglia", "University of California, Berkeley and NBER (email: )"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.2139/ssrn.3894730", "year": 2021, "title": "Credentials Matter, but Only for Men: Evidence from the S&amp;amp;P 500", "journal": "SSRN Electronic Journal", "volume": None, "issue": None, "authors": [["Peter", "Cziraki", None], ["Adriana", "Robertson", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1086/600079", "year": 2009, "title": "Estimation and Identification of Merger Effects: An Application to Hospital Mergers", "journal": "The Journal of Law and Economics", "volume": "52", "issue": "3", "authors": [["Leemore", "Dafny", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1257/aer.103.3.586", "year": 2013, "title": "The Importance of Being Marginal: Gender Differences in Generosity", "journal": "American Economic Review", "volume": "103", "issue": "3", "authors": [["Stefano", "DellaVigna", "Department of Economics, University of California-Berkeley, 515 Evans Hall, Berkeley, CA 94720 and NBER."], ["John A", "List", "Department of Economics, The University of Chicago, 1126 East 59th Street, Chicago, Illinois 60637 and NBER."], ["Ulrike", "Malmendier", "Department of Economics and Haas School of Business, University of California-Berkeley, 501 Evans Hall, Berkeley, CA 94720 and NBER."], ["Gautam", "Rao", "Department of Economics, University of California-Berkeley, 530 Evans Hall, Berkeley, CA 94720."]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1111/1756-2171.12184", "year": 2017, "title": "How do nonprofits respond to negative wealth shocks? The impact of the 2008 stock market collapse on hospitals", "journal": "The RAND Journal of Economics", "volume": "48", "issue": "2", "authors": [["David", "Dranove", "Northwestern University"], ["Craig", "Garthwaite", "Northwestern University"], ["Christopher", "Ody", "Northwestern University"]], "working_paper_institution": None}, {"doi": "10.1002/(SICI)1099-1050(199803)7:2<167::AID-HEC336>3.0.CO;2-#", "type": None, "year": None, "title": None, "journal": None, "volume": None, "issue": None, "authors": [], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/s0165-1765(02)00045-9", "year": 2002, "title": "Gender differences in revealed risk taking: evidence from mutual fund investors", "journal": "Economics Letters", "volume": "76", "issue": "2", "authors": [["Peggy D.", "Dwyer", None], ["James H.", "Gilkeson", None], ["John A.", "List", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1037/0003-066x.50.3.145", "year": 1995, "title": "The science and politics of comparing women and men.", "journal": "American Psychologist", "volume": "50", "issue": "3", "authors": [["Alice H.", "Eagly", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1037/0033-295x.109.3.573", "year": 2002, "title": "Role congruity theory of prejudice toward female leaders.", "journal": "Psychological Review", "volume": "109", "issue": "3", "authors": [["Alice H.", "Eagly", None], ["Steven J.", "Karau", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.2307/3003654", "year": 1983, "title": "The Economic Role of the Nonprofit Firm", "journal": "The Bell Journal of Economics", "volume": "14", "issue": "2", "authors": [["David", "Easley", None], ["Maureen", "O'Hara", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1287/mnsc.2021.4031", "year": 2022, "title": "Valuation Effects of Norway\u2019s Board Gender-Quota Law Revisited", "journal": "Management Science", "volume": "68", "issue": "6", "authors": [["B. Espen", "Eckbo", "Dartmouth College, Hanover, New Hampshire 03755;"], ["Knut", "Nygaard", "Oslo Business School at Oslo Metropolitan University, Oslo 0130, Norway;"], ["Karin S.", "Thorburn", "Norwegian School of Economics, Bergen 5045, Norway;"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1287/mnsc.2021.4031", "year": 2022, "title": "Valuation Effects of Norway\u2019s Board Gender-Quota Law Revisited", "journal": "Management Science", "volume": "68", "issue": "6", "authors": [["B. Espen", "Eckbo", "Dartmouth College, Hanover, New Hampshire 03755;"], ["Knut", "Nygaard", "Oslo Business School at Oslo Metropolitan University, Oslo 0130, Norway;"], ["Karin S.", "Thorburn", "Norwegian School of Economics, Bergen 5045, Norway;"]], "working_paper_institution": None}, {"reference_type": "book", "doi": "10.1016/s1574-0722(07)00113-8", "year": 2008, "title": "Chapter 113 Men, Women and Risk Aversion: Experimental Evidence", "journal": "Handbook of Experimental Economics Results", "volume": None, "issue": None, "authors": [["Catherine C.", "Eckel", None], ["Philip J.", "Grossman", None]], "working_paper_institution": None}, {"title": "The Handbook of the Economics of Corporate Governance", "author": "Edmans Alex", "year": "2017", "reference_type": "article"}, {"reference_type": "article", "doi": "10.1086/718964", "year": 2022, "title": "When Harry Fired Sally: The Double Standard in Punishing Misconduct", "journal": "Journal of Political Economy", "volume": "130", "issue": "5", "authors": [["Mark", "Egan", None], ["Gregor", "Matvos", None], ["Amit", "Seru", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/s0929-1199(03)00031-2", "year": 2004, "title": "Governance, performance objectives and organizational form: evidence from hospitals", "journal": "Journal of Corporate Finance", "volume": "10", "issue": "4", "authors": [["Leslie", "Eldenburg", None], ["Benjamin E", "Hermalin", None], ["Michael S", "Weisbach", None], ["Marta", "Wosinska", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/j.jeconbus.2010.05.003", "year": 2011, "title": "Gender differences in executive compensation: Variation with board gender composition and time", "journal": "Journal of Economics and Business", "volume": "63", "issue": "1", "authors": [["Susan", "Elkinawy", None], ["Mark", "Stater", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/j.jcorpfin.2016.02.008", "year": 2016, "title": "CEO gender, corporate risk-taking, and the efficiency of capital allocation", "journal": "Journal of Corporate Finance", "volume": "39", "issue": None, "authors": [["Mara", "Faccio", None], ["Maria-Teresa", "Marchica", None], ["Roberto", "Mura", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/0304-405x(85)90045-5", "year": 1985, "title": "Organizational forms and investment decisions", "journal": "Journal of Financial Economics", "volume": "14", "issue": "1", "authors": [["Eugene F.", "Fama", None], ["Michael C.", "Jensen", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1093/rfs/hhx040", "year": 2017, "title": "Gender and Connections among Wall Street Analysts", "journal": "The Review of Financial Studies", "volume": "30", "issue": "9", "authors": [["Lily Hua", "Fang", "INSEAD"], ["Sterling", "Huang", "Singapore management University"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1093/rfs/hhs131", "year": 2013, "title": "Managers with and without Style: Evidence Using Exogenous Variation", "journal": "Review of Financial Studies", "volume": "26", "issue": "3", "authors": [["C. Edward", "Fee", "Boston College"], ["Charles J.", "Hadlock", "Boston College"], ["Joshua R.", "Pierce", "Boston College"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1093/rfs/hhs131", "year": 2013, "title": "Managers with and without Style: Evidence Using Exogenous Variation", "journal": "Review of Financial Studies", "volume": "26", "issue": "3", "authors": [["C. Edward", "Fee", "Boston College"], ["Charles J.", "Hadlock", "Boston College"], ["Joshua R.", "Pierce", "Boston College"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/j.jfineco.2020.04.001", "year": 2020, "title": "At the table but can not break through the glass ceiling:Board leadership positions elude diverse directors", "journal": "Journal of Financial Economics", "volume": "137", "issue": "3", "authors": [["Laura Casares", "Field", None], ["Matthew E.", "Souther", None], ["Adam S.", "Yore", None]], "working_paper_institution": None}, {"first-page": "853", "title": "Hospital cost inflation: A study of nonprofit price dynamics", "volume": "61", "author": "Feldstein Martin", "year": "1971", "journal": "American Economic Review", "reference_type": "article"}, {"reference_type": "article", "doi": "10.1016/j.jpubeco.2004.10.005", "year": 2005, "title": "Precautionary savings and the governance of nonprofit organizations", "journal": "Journal of Public Economics", "volume": "89", "issue": "11-12", "authors": [["Raymond", "Fisman", None], ["R.", "Glenn Hubbard", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1093/rfs/hhx078", "year": 2018, "title": "Do Director Elections Matter?", "journal": "The Review of Financial Studies", "volume": "31", "issue": "4", "authors": [["Vyacheslav", "Fos", "Carroll School of Management, Boston College"], ["Kai", "Li", "Sauder School of Business, University of British Columbia"], ["Margarita", "Tsoutsoura", "Samuel Curtis Johnson Graduate School of Management, Cornell University"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1111/j.1468-0009.2011.00621.x", "year": 2011, "title": "How Much Do Hospitals Cost Shift? A Review of the Evidence", "journal": "Milbank Quarterly", "volume": "89", "issue": "1", "authors": [["AUSTIN B.", "FRAKT", None]], "working_paper_institution": None}, {"reference_type": "book", "doi": "10.2307/j.ctv21ptzfk", "year": 2008, "title": "Governing Nonprofit Organizations", "journal": None, "volume": None, "issue": None, "authors": [["Marion R.", "Fremont-Smith", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1093/rfs/hhp120", "year": 2010, "title": "Executive Compensation: A New View from a Long-Term Perspective, 1936\u20132005", "journal": "Review of Financial Studies", "volume": "23", "issue": "5", "authors": [["Carola", "Frydman", None], ["Raven E.", "Saks", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1162/qjec.2008.123.1.49", "year": 2008, "title": "Why Has CEO Pay Increased So Much?<sup>*</sup>", "journal": "Quarterly Journal of Economics", "volume": "123", "issue": "1", "authors": [["Xavier", "Gabaix", "Georgetown University and Indiana University"], ["Augustin", "Landier", "Georgetown University and Indiana University"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1162/qjec.2008.123.1.49", "year": 2008, "title": "Why Has CEO Pay Increased So Much?<sup>*</sup>", "journal": "Quarterly Journal of Economics", "volume": "123", "issue": "1", "authors": [["Xavier", "Gabaix", "Georgetown University and Indiana University"], ["Augustin", "Landier", "Georgetown University and Indiana University"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/j.jfineco.2021.09.003", "year": 2022, "title": "Good for your fiscal health? The effect of the affordable care act on healthcare borrowing costs", "journal": "Journal of Financial Economics", "volume": "145", "issue": "2", "authors": [["Pengjie", "Gao", None], ["Chang", "Lee", None], ["Dermot", "Murphy", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1086/666615", "year": 2012, "title": "Gender Differences in Executive Compensation and Job Mobility", "journal": "Journal of Labor Economics", "volume": "30", "issue": "4", "authors": [["George-Levi", "Gayle", None], ["Limor", "Golan", None], ["Robert A.", "Miller", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.2307/1593787", "year": 2003, "title": "Competition among Hospitals", "journal": "The RAND Journal of Economics", "volume": "34", "issue": "4", "authors": [["Martin", "Gaynor", None], ["William B.", "Vogt", None]], "working_paper_institution": None}, {"reference_type": "working_paper", "doi": "10.3386/w28463", "year": 2021, "title": "Gender Quotas and Support for Women in Board Elections", "journal": None, "volume": None, "issue": None, "authors": [["Marina", "Gertsberg", None], ["Johanna", "Mollerstrom", None], ["Michaela", "Pagel", None]], "working_paper_institution": None}, {"reference_type": "book", "doi": "10.7208/chicago/9780226297866.001.0001", "year": 2003, "title": "The Governance of Not-for-Profit Organizations", "journal": None, "volume": None, "issue": None, "authors": [["Edward L.", "Glaeser", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/s0047-2727(00)00130-4", "year": 2001, "title": "Not-for-profit entrepreneurs", "journal": "Journal of Public Economics", "volume": "81", "issue": "1", "authors": [["Edward L.", "Glaeser", None], ["Andrei", "Shleifer", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.3982/ecta6690", "year": 2009, "title": "Gender Differences in Competition: Evidence\\\\ From a Matrilineal and a Patriarchal Society", "journal": "Econometrica", "volume": "77", "issue": "5", "authors": [], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1162/00335530360698496", "year": 2003, "title": "Performance in Competitive Environments: Gender Differences", "journal": "The Quarterly Journal of Economics", "volume": "118", "issue": "3", "authors": [["U.", "Gneezy", None], ["M.", "Niederle", None], ["A.", "Rustichini", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1257/aer.104.4.1091", "year": 2014, "title": "A Grand Gender Convergence: Its Last Chapter", "journal": "American Economic Review", "volume": "104", "issue": "4", "authors": [["Claudia", "Goldin", "Department of Economics, Harvard University, 229 Littauer, Cambridge, MA 02138 ()"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1257/aer.90.4.715", "year": 2000, "title": "Orchestrating Impartiality: The Impact of \u201cBlind\u201d Auditions on Female Musicians", "journal": "American Economic Review", "volume": "90", "issue": "4", "authors": [["Claudia", "Goldin", "Department of Economics, Harvard University, Cambridge, MA 02183."], ["Cecilia", "Rouse", "Woodrow Wilson School, Princeton University, Princeton, NJ 08544."]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1111/jofi.13212", "year": 2023, "title": "The Gender Gap in Housing Returns", "journal": "The Journal of Finance", "volume": "78", "issue": "2", "authors": [["PAUL", "GOLDSMITH\u2010PINKHAM", None], ["KELLY", "SHUE", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/j.jfineco.2020.04.007", "year": 2020, "title": "CEO-board dynamics", "journal": "Journal of Financial Economics", "volume": "137", "issue": "3", "authors": [["John R.", "Graham", None], ["Hyunseob", "Kim", None], ["Mark", "Leary", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1177/0149206318810415", "year": 2020, "title": "You\u2019re Fired! Gender Disparities in CEO Dismissal", "journal": "Journal of Management", "volume": "46", "issue": "4", "authors": [["Vishal K.", "Gupta", None], ["Sandra C.", "Mortal", "The University of Alabama"], ["Sabatino", "Silveri", "University of Memphis"], ["Minxing", "Sun", "Clemson University"], ["Daniel B.", "Turban", "University of Missouri"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.2307/796089", "year": 1980, "title": "The Role of Nonprofit Enterprise", "journal": "The Yale Law Journal", "volume": "89", "issue": "5", "authors": [["Henry B.", "Hansmann", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1093/rfs/hhs054", "year": 2012, "title": "Dynamic Compensation Contracts with Private Savings", "journal": "Review of Financial Studies", "volume": "25", "issue": "5", "authors": [["Zhiguo", "He", None]], "working_paper_institution": None}, {"first-page": "96", "title": "Endogenously chosen board of directors and their monitoring of the CEO", "volume": "88", "author": "Hermalin Benjamin E.", "year": "1998", "journal": "American Economic Review", "reference_type": "article"}, {"reference_type": "working_paper", "doi": "10.3386/w8161", "year": 2001, "title": "Boards of Directors as an Endogenously Determined Institution: A Survey of the Economic Literature", "journal": None, "volume": None, "issue": None, "authors": [["Benjamin", "Hermalin", None], ["Michael", "Weisbach", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/j.jebo.2011.06.021", "year": 2012, "title": "When should I quit? Gender differences in exiting competitions", "journal": "Journal of Economic Behavior &amp; Organization", "volume": "83", "issue": "1", "authors": [["Robin M.", "Hogarth", None], ["Natalia", "Karelaia", None], ["Carlos Andr\u00e9s", "Trujillo", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1017/s002210901800011x", "year": 2018, "title": "Recruiting the CEO from the Board: Determinants and Consequences", "journal": "Journal of Financial and Quantitative Analysis", "volume": "53", "issue": "3", "authors": [["Udi", "Hoitash", None], ["Anahit", "Mkrtchyan", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.2307/1913238", "year": 1987, "title": "Aggregation and Linearity in the Provision of Intertemporal Incentives", "journal": "Econometrica", "volume": "55", "issue": "2", "authors": [["Bengt", "Holmstrom", None], ["Paul", "Milgrom", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/j.jfineco.2012.12.005", "year": 2013, "title": "Gender and corporate finance: Are male executives overconfident relative to female executives?", "journal": "Journal of Financial Economics", "volume": "108", "issue": "3", "authors": [["Jiekun", "Huang", "Korea University and University of North Carolina"], ["Darren J.", "Kisgen", "Korea University and University of North Carolina"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/j.jfineco.2012.12.005", "year": 2013, "title": "Gender and corporate finance: Are male executives overconfident relative to female executives?", "journal": "Journal of Financial Economics", "volume": "108", "issue": "3", "authors": [["Jiekun", "Huang", "Korea University and University of North Carolina"], ["Darren J.", "Kisgen", "Korea University and University of North Carolina"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/j.jfineco.2012.12.005", "year": 2013, "title": "Gender and corporate finance: Are male executives overconfident relative to female executives?", "journal": "Journal of Financial Economics", "volume": "108", "issue": "3", "authors": [["Jiekun", "Huang", "Korea University and University of North Carolina"], ["Darren J.", "Kisgen", "Korea University and University of North Carolina"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1093/rfs/hhaa069", "year": 2021, "title": "Performance-Induced CEO Turnover", "journal": "The Review of Financial Studies", "volume": "34", "issue": "2", "authors": [["Dirk", "Jenter", "London School of Economics and Political Science and CEPR"], ["Katharina", "Lewellen", "Tuck School of Business, Dartmouth College"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1111/j.1467-8551.1994.tb00073.x", "year": 1994, "title": "Decision Making, Risk and Gender: Are Managers Different?", "journal": "British Journal of Management", "volume": "5", "issue": "2", "authors": [["J.E.V.", "Johnson", None], ["P.L.", "Powell", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/j.jebo.2023.04.017", "year": 2023, "title": "The gender gap among top business executives", "journal": "Journal of Economic Behavior &amp; Organization", "volume": "211", "issue": None, "authors": [["Wolfgang", "Keller", None], ["Teresa", "Molina", None], ["William W.", "Olney", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/j.annemergmed.2013.11.019", "year": 2014, "title": "Admit or Transfer? The Role of Insurance in High-Transfer-Rate Medical Conditions in the Emergency Department", "journal": "Annals of Emergency Medicine", "volume": "63", "issue": "5", "authors": [["Dana R.", "Kindermann", None], ["Ryan L.", "Mutter", None], ["Lara", "Cartwright-Smith", None], ["Sara", "Rosenbaum", None], ["Jesse M.", "Pines", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1037/a0023557", "year": 2011, "title": "Are leader stereotypes masculine? A meta-analysis of three research paradigms.", "journal": "Psychological Bulletin", "volume": "137", "issue": "4", "authors": [["Anne M.", "Koenig", None], ["Alice H.", "Eagly", None], ["Abigail A.", "Mitchell", None], ["Tiina", "Ristikari", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1162/rest_a_00668", "year": 2017, "title": "Women Helping Women? Evidence from Private Sector Data on Workplace Hierarchies", "journal": "The Review of Economics and Statistics", "volume": "99", "issue": "5", "authors": [["Astrid", "Kunze", "NHH Norwegian School of Economics"], ["Amalia R.", "Miller", "University of Virginia, IZA, and NBER"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/j.jpubeco.2005.11.004", "year": 2006, "title": "The nonprofit sector and industry performance", "journal": "Journal of Public Economics", "volume": "90", "issue": "8-9", "authors": [["Darius", "Lakdawalla", "Bucknell University"], ["Tomas", "Philipson", "Bucknell University"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/j.jpubeco.2005.11.004", "year": 2006, "title": "The nonprofit sector and industry performance", "journal": "Journal of Public Economics", "volume": "90", "issue": "8-9", "authors": [["Darius", "Lakdawalla", "Bucknell University"], ["Tomas", "Philipson", "Bucknell University"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/j.jpubeco.2005.11.004", "year": 2006, "title": "The nonprofit sector and industry performance", "journal": "Journal of Public Economics", "volume": "90", "issue": "8-9", "authors": [["Darius", "Lakdawalla", "Bucknell University"], ["Tomas", "Philipson", "Bucknell University"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1016/j.jfineco.2007.03.004", "year": 2008, "title": "The determinants of board structure\u2606", "journal": "Journal of Financial Economics", "volume": "87", "issue": "2", "authors": [["J", "LINCK", None], ["J", "NETTER", None], ["T", "YANG", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1177/0019793920961995", "year": 2022, "title": "Female Leadership and Gender Gap within Firms: Evidence from an Italian Board Reform", "journal": "ILR Review", "volume": "75", "issue": "2", "authors": [["Agata", "Maida", None], ["Andrea", "Weber", "Agata Maida is an Assistant Professor at University of Milan and a Research Fellow at LABORatorio Revelli, Collegio Carlo Alberto. Andrea Weber is a Professor at Central European University and a Research Fellow at both IZA Bonn and CEPR"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1111/j.1540-6261.1991.tb02679.x", "year": 1991, "title": "Corporate Performance, Corporate Takeovers, and Management Turnover", "journal": "The Journal of Finance", "volume": "46", "issue": "2", "authors": [["KENNETH J.", "MARTIN", None], ["JOHN J.", "MCCONNELL", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1257/aer.101.3.635", "year": 2011, "title": "Chipping away at the Glass Ceiling: Gender Spillovers in Corporate Leadership", "journal": "American Economic Review", "volume": "101", "issue": "3", "authors": [["David A", "Matsa", "Finance Department, Kellogg School of Management, Northwestern University, 2001 Sheridan Road, Evanston, IL 60208."], ["Amalia R", "Miller", "Economics Department, University of Virginia, and RAND Corporation, 237 McCormick Road, Charlottesville, VA 22904."]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.2139/ssrn.1636047", "year": 2012, "title": "A Female Style in Corporate Leadership? Evidence from Quotas", "journal": "SSRN Electronic Journal", "volume": None, "issue": None, "authors": [["David A.", "Matsa", None], ["Amalia R.", "Miller", None]], "working_paper_institution": None}, {"first-page": "1497", "title": "The challenges of nonprofit governance", "volume": "62", "author": "Molk Peter,", "year": "2021", "journal": "Boston College Law Review", "reference_type": "article"}, {"reference_type": "article", "doi": "10.1111/acem.12209", "year": 2013, "title": "Interhospital Transfers from U.S. Emergency Departments: Implications for Resource Utilization, Patient Safety, and Regionalization", "journal": "Academic Emergency Medicine", "volume": "20", "issue": "9", "authors": [["Jacob", "Nacht", "Department of Emergency Medicine; University of Colorado School of Medicine; Aurora CO"], ["Marlow", "Macht", "Department of Emergency Medicine; University of Colorado School of Medicine; Aurora CO"], ["Adit A.", "Ginde", "Department of Emergency Medicine; University of Colorado School of Medicine; Aurora CO"]], "working_paper_institution": None}, {"first-page": "64", "title": "Towards a theory of not\u2010for\u2010profit institutions: An economic model of a hospital", "volume": "60", "author": "Newhouse Joseph", "year": "1970", "journal": "American Economic Review", "reference_type": "article"}, {"reference_type": "article", "doi": "10.1162/qjec.122.3.1067", "year": 2007, "title": "Do Women Shy Away From Competition? Do Men Compete Too Much?", "journal": "The Quarterly Journal of Economics", "volume": "122", "issue": "3", "authors": [["M.", "Niederle", None], ["L.", "Vesterlund", None]], "working_paper_institution": None}, {"first-page": "87", "title": "The not\u2010for\u2010profit hospital as a physicians' cooperative", "volume": "63", "author": "Pauly Mark", "year": "1973", "journal": "American Economic Review", "reference_type": "article"}, {"reference_type": "article", "doi": "10.1016/s0304-405x(97)00028-7", "year": 1997, "title": "CEO turnover and outside succession A cross-sectional analysis", "journal": "Journal of Financial Economics", "volume": "46", "issue": "2", "authors": [["Robert", "Parrino", None]], "working_paper_institution": None}, {"first-page": "701", "title": "Altruism, not\u2010for\u2010profits, and economic theory", "volume": "34", "author": "Rose\u2010Ackerman Susan", "year": "1996", "journal": "Journal of Economic Literature", "reference_type": "article"}, {"reference_type": "article", "doi": "10.2307/3003456", "year": 1982, "title": "Authority, Control, and the Distribution of Earnings", "journal": "The Bell Journal of Economics", "volume": "13", "issue": "2", "authors": [["Sherwin", "Rosen", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1111/j.1467-937x.2008.00486.x", "year": 2008, "title": "A Continuous-Time Version of the Principal\u2013Agent Problem", "journal": "Review of Economic Studies", "volume": "75", "issue": "3", "authors": [["YULIY", "SANNIKOV", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1073/pnas.0907352106", "year": 2009, "title": "Gender differences in financial risk aversion and career choices are affected by testosterone", "journal": "Proceedings of the National Academy of Sciences", "volume": "106", "issue": "36", "authors": [["Paola", "Sapienza", "Kellogg School of Management, Northwestern University, Evanston, IL 60208;"], ["Luigi", "Zingales", "University of Chicago Booth School of Business, Chicago, IL 60637; and"], ["Dario", "Maestripieri", "Department of Comparative Human Development, University of Chicago, Chicago, IL 60637"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1073/pnas.0907352106", "year": 2009, "title": "Gender differences in financial risk aversion and career choices are affected by testosterone", "journal": "Proceedings of the National Academy of Sciences", "volume": "106", "issue": "36", "authors": [["Paola", "Sapienza", "Kellogg School of Management, Northwestern University, Evanston, IL 60208;"], ["Luigi", "Zingales", "University of Chicago Booth School of Business, Chicago, IL 60637; and"], ["Dario", "Maestripieri", "Department of Comparative Human Development, University of Chicago, Chicago, IL 60637"]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1086/711401", "year": 2021, "title": "Gender Differences in Recognition for Group Work", "journal": "Journal of Political Economy", "volume": "129", "issue": "1", "authors": [["Heather", "Sarsons", None], ["Klarita", "G\u00ebrxhani", None], ["Ernesto", "Reuben", None], ["Arthur", "Schram", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1037/0022-3514.89.6.1010", "year": 2005, "title": "Sex differences in value priorities: Cross-cultural and multimethod studies.", "journal": "Journal of Personality and Social Psychology", "volume": "89", "issue": "6", "authors": [["Shalom H.", "Schwartz", None], ["Tammy", "Rubel", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1257/jep.35.4.223", "year": 2021, "title": "College Majors, Occupations, and the Gender Wage Gap", "journal": "Journal of Economic Perspectives", "volume": "35", "issue": "4", "authors": [["Carolyn M.", "Sloane", "Carolyn M. Sloane is Assistant Professor of Economics, University of California, Riverside, Riverside, California."], ["Erik G.", "Hurst", "Erik G. Hurst is Frank P. and Marianne R. Diassi Distinguished Service Professor of Economics, University of Chicago Booth School of Business, Chicago, Illinois."], ["Dan A.", "Black", "Dan A. Black is Professor of Public Policy, University of Chicago, Harris School of Public Policy, Chicago, Illinois."]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1111/j.1465-7295.2001.tb00060.x", "year": 2001, "title": "Gender differences in the ultimatum game", "journal": "Economic Inquiry", "volume": "39", "issue": "2", "authors": [["SJ", "Solnick", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1037/0278-7393.30.2.299", "year": 2004, "title": "Overconfidence in Interval Estimates.", "journal": "Journal of Experimental Psychology: Learning, Memory, and Cognition", "volume": "30", "issue": "2", "authors": [["Jack B.", "Soll", None], ["Joshua", "Klayman", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1093/rfs/hhv012", "year": 2015, "title": "The Bright Side of Corporate Diversification: Evidence from Internal Labor Markets", "journal": "Review of Financial Studies", "volume": "28", "issue": "8", "authors": [["Geoffrey", "Tate", None], ["Liu", "Yang", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1111/j.1540-6261.2010.01610.x", "year": 2010, "title": "Why Are CEOs Rarely Fired? Evidence from Structural Estimation", "journal": "The Journal of Finance", "volume": "65", "issue": "6", "authors": [["LUCIAN A.", "TAYLOR", None]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1257/aer.98.3.642", "year": 2008, "title": "The Difference That CEOs Make: An Assignment Model Approach", "journal": "American Economic Review", "volume": "98", "issue": "3", "authors": [["Marko", "Tervi\u00f6", "Haas School of Business, University of California, Berkeley, CA 94720-1900."]], "working_paper_institution": None}, {"reference_type": "article", "doi": "10.1001/jamainternmed.2019.0037", "year": 2019, "title": "Association Between Insurance Status and Access to Hospital Care in Emergency Department Disposition", "journal": "JAMA Internal Medicine", "volume": "179", "issue": "5", "authors": [["Arjun K.", "Venkatesh", "Department of Emergency Medicine, Yale University School of Medicine, New Haven, Connecticut"], ["Shih-Chuan", "Chou", "Department of Emergency Medicine, Brigham and Women's Hospital, Boston, Massachusetts"], ["Shu-Xia", "Li", "Yale New Haven Hospital\u2013Center for Outcomes Research and Evaluation, New Haven, Connecticut"], ["Jennie", "Choi", "Yale University School of Medicine, New Haven, Connecticut"], ["Joseph S.", "Ross", "Yale New Haven Hospital\u2013Center for Outcomes Research and Evaluation, New Haven, Connecticut"], ["Gail", "D\u2019Onofrio", "Department of Emergency Medicine, Yale University School of Medicine, New Haven, Connecticut"], ["Harlan M.", "Krumholz", "Yale New Haven Hospital\u2013Center for Outcomes Research and Evaluation, New Haven, Connecticut"], ["Kumar", "Dharmarajan", "Clover Health, Jersey City, New Jersey"]], "working_paper_institution": None}], "reference_stats": {"total_references": 127, "parsed_references": 127, "skipped_references": 0}}
    
    # Save example paper to a file
    example_paper_path = os.path.join(args.output_dir, 'example_paper.json')
    with open(example_paper_path, 'w') as f:
        json.dump(example_paper, f, indent=2)
    
    print(f"Saved example paper to {example_paper_path}")
    
    # Set inductive mode flag
    inductive_flag = "--inductive" if args.inductive else ""
    
    # Set feature importance flag
    feature_importance_flag = "--feature-importance" if args.feature_importance else ""
    
    # Run evaluate_gnn.py in evaluation mode
    evaluation_output_path = os.path.join(args.output_dir, 'evaluation_results.json')
    
    # Define mode name for logging
    mode_name = "inductive" if args.inductive else "transductive"
    
    # Evaluation command
    cmd = f"python evaluate_gnn.py --input {example_paper_path} --output {evaluation_output_path} --mode evaluate --observed-ratio {args.observed_ratio} --top-k {args.top_k} --device {args.device} {inductive_flag} {feature_importance_flag}"
    
    print(f"Running {mode_name} evaluation: {cmd}")
    os.system(cmd)
    
    # Process the evaluation results to mark citations
    with open(evaluation_output_path, 'r') as f:
        evaluation_results = json.load(f)
    
    # Check for errors
    if 'error' in evaluation_results:
        print(f"Error in evaluation: {evaluation_results['error']}")
    else:
        # Get held-out citations
        held_out_citations = evaluation_results.get('held_out_citation_ids', [])
        
        # Mark recommendations as actual citations or not in dataset
        for rec in evaluation_results.get('recommendations', []):
            if rec['id'] in held_out_citations:
                rec['status'] = 'ACTUAL_CITATION'
                rec['checkbox'] = '[âœ“]'  # ASCII-compatible checkbox for actual citations
            else:
                # Check if this paper is in the dataset but not cited
                rec['status'] = 'NOT_CITED'
                rec['checkbox'] = '[ ]'  # ASCII-compatible checkbox for non-citations
        
        # Save the updated results
        with open(evaluation_output_path, 'w') as f:
            json.dump(evaluation_results, f, indent=2)
    
    # Run evaluate_gnn.py in recommendation mode
    recommendation_output_path = os.path.join(args.output_dir, 'recommendation_results.json')
    cmd = f"python evaluate_gnn.py --input {example_paper_path} --output {recommendation_output_path} --mode recommend --top-k {args.top_k} --device {args.device} {inductive_flag} {feature_importance_flag}"
    
    print(f"Running {mode_name} recommendation: {cmd}")
    os.system(cmd)
    
    # Process the recommendation results
    try:
        with open(recommendation_output_path, 'r') as f:
            recommendation_results = json.load(f)
        
        # Check for errors
        if 'error' in recommendation_results:
            print(f"Error in recommendation: {recommendation_results['error']}")
        else:
            # Get all citations from the original paper
            all_citations = []
            for ref in example_paper.get('references', []):
                if ref.get('reference_type') == 'article' and ref.get('title'):
                    all_citations.append(ref.get('title'))
            
            # Mark recommendations
            for rec in recommendation_results.get('recommendations', []):
                if any(citation_title.lower() in rec['title'].lower() or rec['title'].lower() in citation_title.lower() 
                       for citation_title in all_citations):
                    rec['status'] = 'ALREADY_CITED'
                    rec['checkbox'] = '[C]'  # ASCII-compatible marker for already cited papers
                else:
                    rec['status'] = 'NEW_RECOMMENDATION'
                    rec['checkbox'] = '[N]'  # ASCII-compatible marker for new recommendations
            
            # Save the updated recommendation results
            with open(recommendation_output_path, 'w') as f:
                json.dump(recommendation_results, f, indent=2)
            
            # Print summary with status information
            print("\nEvaluation Results Summary:")
            if 'error' in evaluation_results:
                print(f"Error: {evaluation_results['error']}")
            else:
                print(f"Total held-out citations: {len(held_out_citations)}")
                actual_citations_found = sum(1 for rec in evaluation_results.get('recommendations', []) if rec.get('status') == 'ACTUAL_CITATION')
                print(f"Actual citations found in top {args.top_k}: {actual_citations_found}")
                
                # Print evaluation metrics
                if 'recall@'+str(args.top_k) in evaluation_results:
                    print(f"Recall@{args.top_k}: {evaluation_results[f'recall@{args.top_k}']:.4f}")
                    print(f"Precision@{args.top_k}: {evaluation_results[f'precision@{args.top_k}']:.4f}")
                    print(f"NDCG@{args.top_k}: {evaluation_results[f'ndcg@{args.top_k}']:.4f}")
                
                # Print ALL evaluation recommendations with status markers
                print(f"\nALL Top {args.top_k} Evaluation Recommendations:")
                print("=" * 100)
                for rec in evaluation_results.get('recommendations', []):
                    status_marker = rec.get('checkbox', '')
                    print(f"{rec.get('rank', 0):2d}. {status_marker} {rec.get('title', 'Unknown Title')} (Score: {rec.get('score', 0):.4f})")
                    print(f"    Authors: {rec.get('authors', '')}")
                    print(f"    Journal: {rec.get('journal', '')}")
                    print(f"    Status: {rec.get('status', '')}")
                    
                    # Show feature importance if available
                    if args.feature_importance and 'feature_importance' in rec:
                        importance_display = format_feature_importance(rec['feature_importance'])
                        if importance_display:
                            print(importance_display)
                    
                    print()
            
            print("\nRecommendation Results Summary:")
            already_cited = sum(1 for rec in recommendation_results.get('recommendations', []) if rec.get('status') == 'ALREADY_CITED')
            new_recommendations = sum(1 for rec in recommendation_results.get('recommendations', []) if rec.get('status') == 'NEW_RECOMMENDATION')
            print(f"Already cited papers in recommendations: {already_cited}")
            print(f"New recommendations: {new_recommendations}")
            
            # Print ALL recommendation results with status markers
            print(f"\nALL Top {args.top_k} Recommendation Results:")
            print("=" * 100)
            for rec in recommendation_results.get('recommendations', []):
                status_marker = rec.get('checkbox', '')
                print(f"{rec.get('rank', 0):2d}. {status_marker} {rec.get('title', 'Unknown Title')} (Score: {rec.get('score', 0):.4f})")
                print(f"    Authors: {rec.get('authors', '')}")
                print(f"    Journal: {rec.get('journal', '')}")
                print(f"    Status: {rec.get('status', '')}")
                
                # Show feature importance if available
                if args.feature_importance and 'feature_importance' in rec:
                    importance_display = format_feature_importance(rec['feature_importance'])
                    if importance_display:
                        print(importance_display)
                
                print()
    except Exception as e:
        print(f"Error processing recommendation results: {e}")
    
    # Print mode summary
    print(f"\nTest complete for {mode_name} mode!")
    print(f"Evaluation results saved to {evaluation_output_path}")
    print(f"Recommendation results saved to {recommendation_output_path}")
    print(f"Legend: [âœ“]=Actual citation that was held out, [ ]=Not cited, [C]=Already cited, [N]=New recommendation")
    print(f"ðŸ“Š Feature importance analysis included for each recommendation")
    print(f"   - Node embeddings: Cosine similarity and contribution to prediction")
    print(f"   - Edge features: Individual feature importance and values")
    print(f"   - Contribution breakdown: Percentage split between embeddings vs features")

if __name__ == "__main__":
    main() 
